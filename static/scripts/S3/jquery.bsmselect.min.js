(function(a){function b(d,c){this.$original=a(d);this.$container=null;this.$select=null;this.$list=null;this.buildingSelect=false;this.ieClick=false;this.ignoreOriginalChangeEvent=false;this.uid=0;this.optIndex=0;this.options=c;this.buildDom()}b.prototype={buildUid:function(c){return this.options.containerClass+c},buildDom:function(){var c=this,e=this.options;for(var d=0;a("#"+this.buildUid(d)).size();d++){}this.uid=this.buildUid(d);this.$select=a("<select>",{"class":e.selectClass,name:e.selectClass+this.uid,id:e.selectClass+this.uid,change:function(f){c.selectChangeEvent.call(c,f)},click:function(f){c.selectClickEvent.call(c,f)}});if(a.isFunction(e.listType)){this.$list=e.listType(this.$original)}else{this.$list=a("<"+e.listType+">",{id:e.listClass+this.uid})}this.$list.addClass(e.listClass);this.$container=a("<div>",{"class":e.containerClass,id:this.uid});this.buildSelect();this.$original.change(function(f){c.originalChangeEvent.call(c,f)}).wrap(this.$container).before(this.$select);if(!this.$list.parent().length){this.$original.before(this.$list)}if(this.$original.attr("id")){a("label[for="+this.$original.attr("id")+"]").attr("for",this.$select.attr("id"))}this.$list.delegate("."+e.removeClass,"click",function(){c.dropListItem(a(this).closest("li"));return false})},selectChangeEvent:function(){if(a.browser.msie&&a.browser.version<7&&!this.ieClick){return}var c=a("option:selected:eq(0)",this.$select);if(c.attr("rel")){this.addListItem(c);this.triggerOriginalChange(c.attr("rel"),"add")}this.ieClick=false},selectClickEvent:function(){this.ieClick=true},originalChangeEvent:function(){if(this.ignoreOriginalChangeEvent){this.ignoreOriginalChangeEvent=false}else{this.buildSelect();if(a.browser.opera){this.$list.hide().show()}}},buildSelect:function(){var c=this;this.buildingSelect=true;this.optIndex=0;this.$select.empty().prepend(a('<option value="">').text(this.$original.attr("title")||this.options.title));this.$list.empty();this.$original.children().each(function(){if(a(this).is("option")){c.addSelectOption(c.$select,a(this))}else{if(a(this).is("optgroup")){c.addSelectOptionGroup(c.$select,a(this))}}});if(!this.options.debugMode){this.$original.hide()}this.selectFirstItem();this.buildingSelect=false},addSelectOption:function(g,f){if(!f.attr("id")){f.attr("id",this.uid+"-option"+this.optIndex)}var h=f.attr("id"),e=a("<option>",{text:f.text(),val:f.val(),rel:h}).appendTo(g),d=f.is(":selected"),c=f.is(":disabled");if(d&&!c){this.addListItem(e);this.disableSelectOption(e)}else{if(!d&&c){this.disableSelectOption(e)}}this.optIndex++},addSelectOptionGroup:function(f,e){var d=this,c=a("<optgroup>",{label:e.attr("label")}).appendTo(f);if(e.is(":disabled")){c.attr("disabled","disabled")}e.find("option").each(function(g,h){d.addSelectOption(c,a(h))})},selectFirstItem:function(){a("option:eq(0)",this.$select).attr("selected","selected")},disableSelectOption:function(c){c.addClass(this.options.optionDisabledClass).removeAttr("selected").attr("disabled","disabled");if(this.options.hideWhenAdded){c.hide()}if(a.browser.msie){this.$select.hide().show()}},enableSelectOption:function(c){c.removeClass(this.options.optionDisabledClass).removeAttr("disabled");if(this.options.hideWhenAdded){c.show()}if(a.browser.msie){this.$select.hide().show()}},addListItem:function(f){var c,d=a("#"+f.attr("rel")),g=this.options,e=this.options.animate;if(!d){return}if(!this.buildingSelect){if(d.is(":selected")){return}d.attr("selected","selected")}c=a("<li>",{rel:f.attr("rel"),"class":g.listItemClass}).append(a("<span>",{"class":g.listItemLabelClass,html:g.extractLabel(d,g)})).append(a("<a>",{href:"#","class":g.removeClass,html:g.removeLabel})).hide();this.$list[g.addItemTarget=="top"&&!this.buildingSelect?"prepend":"append"](c);if(!this.buildingSelect){if(e===true){a.fn.bsmSelect.effects.verticalListAdd(c)}else{if(a.isFunction(e.add)){e.add(c)}else{if(typeof(e.add)=="string"&&a.isFunction(a.fn.bsmSelect.effects[e.add])){a.fn.bsmSelect.effects[e.add](c)}else{c.show()}}}}else{c.show()}this.disableSelectOption(f);if(!this.buildingSelect){this.highlight(c,g.highlightAddedLabel);this.selectFirstItem()}},dropListItem:function(c){var f=c.attr("rel"),d=a("#"+f),e=this.options.animate;d.removeAttr("selected");if(!this.buildingSelect){if(e===true){a.fn.bsmSelect.effects.verticalListRemove(c)}else{if(a.isFunction(e.drop)){e.drop(c)}else{if(typeof(e.drop)=="string"&&a.isFunction(a.fn.bsmSelect.effects[e.drop])){a.fn.bsmSelect.effects[e.drop](c)}else{c.remove()}}}}else{c.remove()}this.enableSelectOption(a("[rel="+f+"]",this.$select));this.highlight(c,this.options.highlightRemovedLabel);this.triggerOriginalChange(f,"drop")},highlight:function(c,d){var e=this.options.highlight;if(e===true){a.fn.bsmSelect.effects.highlight(this.$select,c,d,this.options)}else{if(a.isFunction(e)){e(this.$select,c,d,this.options)}else{if(typeof(e)=="string"&&a.isFunction(a.fn.bsmSelect.effects[e])){a.fn.bsmSelect.effects[e](this.$select,c,d,this.options)}}}},triggerOriginalChange:function(d,c){var e=a("#"+d);this.ignoreOriginalChangeEvent=true;this.$original.trigger("change",[{option:e,value:e.val(),id:d,item:this.$list.children("[rel="+d+"]"),type:c}])}};a.fn.bsmSelect=function(c){var d=a.extend({},a.fn.bsmSelect.conf,c);return this.each(function(){var e=a(this).data("bsmSelect");if(!e){e=new b(a(this),d);a(this).data("bsmSelect",e)}})};a.extend(a.fn.bsmSelect,{conf:{listType:"ol",highlight:false,animate:false,addItemTarget:"bottom",hideWhenAdded:false,debugMode:false,title:"Select...",removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",extractLabel:function(c){return c.html()},containerClass:"bsmContainer",selectClass:"bsmSelect",optionDisabledClass:"bsmOptionDisabled",listClass:"bsmList",listItemClass:"bsmListItem",listItemLabelClass:"bsmListItemLabel",removeClass:"bsmListItemRemove",highlightClass:"bsmHighlight"},effects:{highlight:function(f,c,e,d){var h,g=f.attr("id")+d.highlightClass;a("#"+g).remove();h=a("<span>",{"class":d.highlightClass,id:g,html:e+c.children("."+d.listItemLabelClass).first().text()}).hide();f.after(h.fadeIn("fast").delay(50).fadeOut("slow",function(){a(this).remove()}))},verticalListAdd:function(c){c.animate({opacity:"show",height:"show"},100,function(){a(this).animate({height:"+=2px"},100,function(){a(this).animate({height:"-=2px"},100)})})},verticalListRemove:function(c){c.animate({opacity:"hide",height:"hide"},100,function(){a(this).prev("li").animate({height:"-=2px"},100,function(){a(this).animate({height:"+=2px"},100)});a(this).remove()})}}})})(jQuery);